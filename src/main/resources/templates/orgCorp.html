
<!DOCTYPE html>
<!--[if lt IE 8]> <html class="lt-ie10 lt-ie9 lt-ie8" lang="ko"> <![endif]-->
<!--[if IE 8]>    <html class="lt-ie10 lt-ie9" lang="ko"> <![endif]-->
<!--[if IE 9]>    <html class="lt-ie10" lang="ko"> <![endif]-->
<!--[if gt IE 9]><!--> <html lang="ko"> <!--<![endif]-->
<head>
	<!-- Head -->
	<!--  <%@ include file="../common/defaultHeaderImport.jsp" %>  -->
	<!-- //Head -->
</head>
<body>
	<div id="wrap">
		<!-- 헤더영역 --> 
		<!--  <%@ include file="../common/commonHeader.jsp" %>  -->
		<!-- //헤더영역 -->

		<!-- 컨텐츠 영역 -->
		<section id="container">		
			<!-- lnb -->
			<!-- <%@ include file="../common/commonLnbCompany.jsp" %>  -->
			<!-- //lnb -->

			<div id="contents">
				<h2 id="pageTit" class="page_tit">법인정보</h2>
				
				<div class="cont_in">
					<table class="table2">
						<colgroup>
							<col style="width:150px" />
							
							<col style="width:150px" />
							
						</colgroup>
						<tbody>
							<tr>
								<th scope="row">법인</th>
								<td>
									<input type="text" class="input w200" id="corp_cd" />
								</td>
								<th scope="row">사업자번호</th>
								<td>
									<input type="text" class="input w200" id="corp_reg_num" />
								</td>
							</tr>
							<tr>
								<th scope="row">사용여부</th>
								<td colspan="3">
									<select class="select w200" id="use_yn">
										<option value="">전체</option>
										<option value="Y">사용</option>
										<option value="N">비사용</option>
									</select>
								</td>
							</tr>
						</tbody>
					</table>
					<div class="t_right mt20">
						<button class="button btn_gray h40 w100" id="select_btn">조회</button>
						<button class="button btn_green h40 w100" id="add_btn">추가</button>
						<button class="button btn_red h40 w100" id="delete_btn">삭제</button>
						<button class="button btn_black h40 w100" id="cancel_btn">취소</button>
						<button class="button btn_blue h40 w100" id="save_btn">저장</button>
					</div>
					<hr/>
					
					<div class="grid_wrap">
						<div class="left">
							<!-- 테이블 -->
							<table id="jqGrid"></table>
							<div id="jqGridPager"></div>
						</div>
						<div class="right">
						<form id="ajaxForm">
							<table class="table tbl_left">
								<caption>테이블 제목</caption>
								<colgroup>
									<col style="width:15%;" />
									<col style="width:35%;" />
									<col style="width:15%;" />
									<col style="width:35%;" />
								</colgroup>
								<tbody>
									<tr>
										<th scope="row">법인코드</th>
										<td colspan="3"><input data-valid-message="법인코드" data-valid-required="true" data-valid-maxlength="10" type="text" class="input readonly w200" name="corpCd" readonly="readonly" /></td>
									</tr>
									<tr>
										<th scope="row">법인</th>
										<td colspan="3"><input type="text" data-valid-message="법인명" data-valid-required="true" data-valid-maxlength="10" class="input w200" name="compNm" /></td>
									</tr>
									<tr>
										<th scope="row">사업자번호</th>
										<td><input type="text" class="input w200" data-valid-message="사업자번호" data-valid-required="true" data-valid-maxlength="10" name="corpRegNum" /></td>
										<th scope="row">대표자</th>
										<td><input type="text" class="input w200" data-valid-message="대표자명" data-valid-required="true" name="represNm" /></td>
									</tr>
									<tr>
										<th scope="row">주소</th>
										<td colspan="3">
											<span class="inp_search">
												<input type="text" name="zipNum" data-valid-message="우편번호" data-valid-required="true" data-valid-maxlength="7" id="postcode" class="input readonly" placeholder="우편번호" readonly="readonly" /><a class="button btn_fa" href="javascript:daumPostcode()" ><i class="fa fa-search" aria-hidden="true" ></i></a>
											</span>
											<p class="mt10"><input name="addr1" type="text" data-valid-message="우편주소" data-valid-required="true" id="address" class="input readonly w400" readonly="readonly"  placeholder="우편주소" /></p>
											<p class="mt10"><input name="addr2" type="text" data-valid-message="상세주소" data-valid-required="true" id="address2" class="input w400" placeholder="상세주소" /></p>
										</td>
									</tr>
									<tr>
										<th scope="row">업태</th>
										<td><input type="text" data-valid-message="업태명" data-valid-required="true" class="input w200" name="businCondNm" /></td>
										<th scope="row">업종</th>
										<td><input type="text" data-valid-message="업종명" data-valid-required="true" class="input w200" name="businTypeNm" /></td>
									</tr>
									<tr>
										<th scope="row">회계년도개시월</th>
										<td colspan="3"><input type="text" data-valid-message="회계년도개시월" data-valid-required="true" data-valid-regex="true" data-valid-maxlength="2" class="input w200" name="FINAN_O_MM" /></td>
									</tr>
									<tr>
										<th scope="row" rowspan="3">마감년월</th>
										<td>
											<strong class="subth">수불</strong><span class="datepicker_wrap">
											<input class="input datepicker_month" data-valid-message="수불" data-valid-required="true" data-valid-maxlength="7" type="text" name="closeYm1" title="날짜입력" /></span>
										</td>
										<td colspan="2">
											<strong class="subth">미수</strong>
											<span class="datepicker_wrap">
											<input class="input datepicker_month" data-valid-message="미수" data-valid-required="true" data-valid-maxlength="7"  type="text" name="closeYm2" title="날짜입력" /></span>
										</td>
									</tr>
									<tr>
										<td>
											<strong class="subth">판매</strong><span class="datepicker_wrap">
											<input class="input datepicker_month" data-valid-message="판매" data-valid-required="true" data-valid-maxlength="7"  type="text" name="closeYm3" title="날짜입력" /></span>
										</td>
										<td colspan="2">
											<strong class="subth">마일리지</strong><span class="datepicker_wrap">
											<input class="input datepicker_month" data-valid-message="마일리지" data-valid-required="true" data-valid-maxlength="7"  type="text" name="closeYm4" title="날짜입력" /></span>
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<strong class="subth">SMS</strong><span class="datepicker_wrap">
											<input class="input datepicker_month" data-valid-message="SMS" data-valid-required="true" data-valid-maxlength="7"  type="text" name="closeYm5" title="날짜입력" /></span>
										</td>
									</tr>
									<tr>
										<th scope="row" rowspan="2">모바일버전</th>
										<td>
											<strong class="subth">웹</strong>
											<input class="input w100" data-valid-message="웹모바일버전" data-valid-required="true" data-valid-maxlength="4"  name="mobVerWeb" type="text" />
										</td>
										<td colspan="2">
											<strong class="subth">메뉴</strong>
											<input class="input w100" name="mobVerMenu" type="text" data-valid-message="메뉴모바일버전" data-valid-required="true" data-valid-maxlength="4" />
										</td>
									</tr>
									<tr>
										<td colspan="3">
											<strong class="subth">이미지</strong>
											<input class="input w100" name="mobVerImg" data-valid-message="이미지모바일버전" data-valid-required="true" data-valid-maxlength="4" type="text" />
										</td>
									</tr>
									<tr>
										<th scope="row">라이센스기간</th>
										<td colspan="3">
											<span class="datepicker_wrap">
											<input class="input datepicker" data-valid-message="라이센스시작일자" data-valid-required="true" data-valid-maxlength="8" name="LICENSE_S_DT" type="text" title="날짜입력" /></span>
											~
											<span class="datepicker_wrap">
											<input class="input datepicker" data-valid-message="라이센스종료일자" data-valid-required="true" data-valid-maxlength="8" name="LICENSE_E_DT" type="text" title="날짜입력" /></span>
										</td>
									</tr>
									<tr>
										<th scope="row">사용여부</th>
										<td colspan="3">
											<select class="select w200" name="useYn">
												<option value="Y">사용</option>
												<option value="N">비사용</option>
											</select>
										</td>
									</tr>
								</tbody>
							</table>
						</form>
						</div>
					</div>
				</div>
			</div>

		</section>
		<!-- //컨텐츠 영역 -->

		<!-- 푸터영역 -->
		<!--  <%@ include file="../common/commonFooter.jsp" %>  -->
		<!-- 푸터영역 -->
	</div>


<script type="text/javascript">// <![CDATA[
	
	var companyFlag = "";
	var mydata = [];
	var saveData = [];
	var param = [];
	
	//JqGrid 그리기	
	var jqGridDraw = function(mydata) {
		$("#jqGrid").jqGrid({
			datatype : "local",
			data : mydata,
			autowidth : true,
			height : 520,
			colNames : [ '상태', '기업', '법인코드', '법인' ],
			colModel : [ {
				name : 'th1',
				width : 100,
				align : 'center'
			}, {
				name : 'th2',
				width : 200,
				align : 'center'
			}, {
				name : 'th3',
				width : 100,
				align : 'center'
			}, {
				name : 'th4',
				width : 200,
				align : 'center'
			} ],
			viewrecords : true,// show the current page,data rang and total records on the toolbar
			pager : '#jqGridPager',
			rowNum : 20,
			rowList : [ 20, 40, 60 ],

			onCellSelect : function(rowid, icol, cellcontnent, e) {
				
				var pageNum = $("input.ui-pg-input.ui-corner-all").val();
				var rowNum = $("select.ui-pg-selbox.ui-widget-content.ui-corner-all").val();

				companyFlag = "UPDATE";
				selectData = [];
				
				var data = saveData[((pageNum-1) * rowNum) + (rowid - 1)];
				selectData = data;
				
				$(":input[name=corpCd]").prop("readonly", true);

				var data = saveData[rowid - 1];
				for (key in data) {
					$('input[name="' + key + '"]').val(data[key]);
					$("#ajaxForm :input[name=useYn]").val(data["useYn"]);
				}
			}
		});
	}
		
	
	var getCompany = function() {
		
		//로딩바 show
		loadingShow();
		
		$.ajax({
			url : "/orgInfo/api/getCorpInfo",
			method : "GET",
			data : {
				corp_cd : $("#corp_cd").val().trim(),
				corp_reg_num : $("#corp_reg_num").val().trim(),
				use_yn : $("#use_yn").val()
			},
			success : function(data) {
				mydata = [];
				saveData = data;
				for (var i = 0; i < data.length; i++) {
					var useYn = data[i].useYn == "Y" ? "사용" : "비사용";
					mydata.push({
						th1 : useYn,
						th2 : data[i].corpNm,
						th3 : data[i].corpCd,
						th4 : data[i].compNm
					});
				}
				$("#jqGrid").jqGrid('clearGridData').jqGrid('setGridParam', {
					data : mydata
				}).trigger('reloadGrid', [ {
					page : 1
				} ]);
				
				//로딩바 hide
				loadingHide();
			}
		})
	}

	var validCompany = function(url) {
		var isValid = true;
		if (!neneValidator.isValid($('#ajaxForm'))) return;
		companyAjax(url);
	}

	$(document).ready(function() {

		jqGridDraw(mydata);

		$("#select_btn").on("click", function() {
			getCompany();
		});

		$("#add_btn").on("click", function() {
			companyFlag = "ADD";
			$("#ajaxForm :input[type=text]").val("");
			$("#ajaxForm :input[name=useYn]").val("Y")
			$(":input[name=corpCd]").prop("readonly", false);
		});

		$("#save_btn").on("click", function() {
			if (companyFlag == "ADD") {
				validCompany("/orgInfo/api/addCorp");
			} else if (companyFlag == "UPDATE") {
				validCompany("/orgInfo/api/updCorp");
			}
		});

		$("#delete_btn").on("click", function() {
			if (confirm("정말로 삭제하시겠습니까? 데이터 복구는 불가능합니다.")) {
				companyAjax("/orgInfo/api/delCorp");
			}
		})

		$("#cancel_btn").on("click", function() {
			if (confirm("취소하시겠습니까?")) location.reload();
		})
	});

	var companyAjax = function(url) {
		
		//로딩바 show
		loadingShow();
		
		$.ajax({
			url : url,
			method : "POST",
			contentType : "application/json; charset=utf-8",
			data : JSON.stringify($("#ajaxForm").serializeObject()),
			success : function(data) {
				alert(data.message);
				getCompany();
				
				//로딩바 hide
				loadingHide();
			},
			error : function(e) {
				alert("요청실패");
				//로딩바 hide
				loadingHide();
				console.log(e);
			}
		})
	}


// ]]></script>

<!-- 우편번호 -->
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<script>
    function daumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var fullAddr = ''; // 최종 주소 변수
                var extraAddr = ''; // 조합형 주소 변수

                // 사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    fullAddr = data.roadAddress;

                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    fullAddr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 조합한다.
                if(data.userSelectedType === 'R'){
                    //법정동명이 있을 경우 추가한다.
                    if(data.bname !== ''){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있을 경우 추가한다.
                    if(data.buildingName !== ''){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 조합형주소의 유무에 따라 양쪽에 괄호를 추가하여 최종 주소를 만든다.
                    fullAddr += (extraAddr !== '' ? ' ('+ extraAddr +')' : '');
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('postcode').value = data.zonecode; //5자리 새우편번호 사용
                document.getElementById('address').value = fullAddr;

                // 커서를 상세주소 필드로 이동한다.
                document.getElementById('address2').focus();
            }
        }).open();
    }
</script>
</body>
</html>

